#!/usr/bin/env python

# Emacs: treat this as -*- python -*-

import os
import sys
from optparse import OptionParser


parser = OptionParser(usage='%prog [options] file [, file2, ...]',
                      version='%prog 0.1')
parser.add_option('-w', '--remove-wave-functions', action='store_true',
                  default=False,
                  help='Remove wave functions from restart file.')
parser.add_option('-i', '--information', action='store_true',
                  default=False,
                  help='Write information about restart file.')
parser.add_option('-e', '--energy', action='store_true',
                  default=False,
                  help='Write energy from restart file.')

opt, args = parser.parse_args()

if len(args) == 0:
    print 'Missing file'
    sys.exit()

if opt.remove_wave_functions:
    for name in args:
        import gpaw
        atoms = gpaw.Calculator.ReadAtoms(name, out=None)
        atoms.GetCalculator().Write(name, '')

if opt.information:
    for name in args:
        if name.endswith('.gpw'):
            os.system('tar -f %s -xO info.xml' % name)
        else:
            os.system('ncdump -h %s' % name)
            
if opt.energy:
    for name in args:
        import gpaw
        atoms = gpaw.Calculator.ReadAtoms(name, out=None)
        print atoms.GetPotentialEnergy()
